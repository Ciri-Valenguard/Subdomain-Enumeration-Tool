<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subdomain Enumeration & Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .mono {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="container">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-teal-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            Attack Surface Mapping Tool
        </h1>
        <p class="text-sm text-gray-500 mb-6">Simulates finding and analyzing subdomains using public certificate transparency logs (e.g., crt.sh).</p>

        <!-- Input Section -->
        <div class="card p-6 mb-8">
            <label for="targetDomain" class="block text-sm font-medium text-gray-700 mb-2">Target Base Domain (e.g., example.com)</label>
            <div class="flex flex-col sm:flex-row gap-3">
                <input type="text" id="targetDomain" value="gemini.com"
                       class="w-full sm:flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500 transition duration-150 text-base">
                <button id="analyzeButton" onclick="runAnalysis()"
                        class="sm:w-auto px-6 py-3 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition duration-150">
                    Run Enumeration
                </button>
            </div>
        </div>

        <!-- Analysis Findings (The Value Add) -->
        <div class="card p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.332 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                Security Findings & Recommendations
            </h2>
            <div id="findingsList" class="space-y-3">
                <p class="text-gray-500 italic" id="initialMessage">Enter a domain and run the enumeration to see the security analysis.</p>
            </div>
        </div>

        <!-- Raw Results Table -->
        <div class="card p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
                Discovered Assets List (<span id="assetCount">0</span>)
            </h2>
            <div class="overflow-x-auto h-96">
                <table class="w-full text-left mono">
                    <thead>
                        <tr class="bg-gray-100 text-gray-700 uppercase text-xs">
                            <th class="p-3 w-1/2">Subdomain (Common Name)</th>
                            <th class="p-3 w-1/4">Certificate Issuer</th>
                            <th class="p-3 w-1/4">Expiration Date</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <tr id="placeholderRow"><td colspan="3" class="p-4 text-center text-gray-400">No data loaded.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        const targetDomainInput = document.getElementById('targetDomain');
        const resultsTableBody = document.getElementById('resultsTableBody');
        const assetCountSpan = document.getElementById('assetCount');
        const findingsList = document.getElementById('findingsList');
        const initialMessage = document.getElementById('initialMessage');
        const analyzeButton = document.getElementById('analyzeButton');
        
        // --- MOCK DATA SIMULATION (To avoid CORS issues with crt.sh) ---
        // In a real application, this function would contain a fetch() call to a proxy server
        // that hits the crt.sh API endpoint: https://crt.sh/?q=%25.<domain>&output=json
        function getMockCrtShData(domain) {
            domain = domain.toLowerCase().replace(/^(www\.|m\.)/, '');

            if (domain === 'gemini.com') {
                return [
                    { common_name: 'gemini.com', issuer_name: 'Google Trust Services LLC', not_after: '2026-10-20' },
                    { common_name: 'app.gemini.com', issuer_name: 'Google Trust Services LLC', not_after: '2026-09-15' },
                    { common_name: 'api-dev.gemini.com', issuer_name: 'Let\'s Encrypt', not_after: '2025-01-05' },
                    { common_name: 'sTaGe-test.gemini.com', issuer_name: 'Internal CA', not_after: '2024-12-10' }, // Expired
                    { common_name: 'legacy-ftp.gemini.com', issuer_name: 'Google Trust Services LLC', not_after: '2026-11-01' },
                    { common_name: '*.blog.gemini.com', issuer_name: 'Google Trust Services LLC', not_after: '2026-12-30' }, // Wildcard
                ];
            } else if (domain === 'example.com') {
                 return [
                    { common_name: 'example.com', issuer_name: 'Test Issuer', not_after: '2026-03-01' },
                    { common_name: 'webmail.example.com', issuer_name: 'Test Issuer', not_after: '2026-03-01' },
                    { common_name: 'ftp.example.com', issuer_name: 'Test Issuer', not_after: '2025-05-10' },
                 ];
            } else {
                return []; // No results found
            }
        }

        // --- CORE ANALYSIS LOGIC ---

        function runAnalysis() {
            const domain = targetDomainInput.value.trim().toLowerCase();
            if (!domain) return;

            // Show loading state
            analyzeButton.textContent = 'Analyzing...';
            analyzeButton.disabled = true;
            resultsTableBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-indigo-500">Fetching and analyzing certificate data...</td></tr>';
            findingsList.innerHTML = '';
            initialMessage.style.display = 'none';

            // Simulate the fetch delay
            setTimeout(() => {
                const rawData = getMockCrtShData(domain);
                
                if (rawData.length === 0) {
                    findingsList.innerHTML = `<p class="text-yellow-600 font-semibold">No assets found for ${domain} in the simulated data.</p>`;
                    resultsTableBody.innerHTML = '<tr><td colspan="3" class="p-4 text-center text-gray-400">0 Assets found.</td></tr>';
                    assetCountSpan.textContent = '0';
                } else {
                    const analysisResults = performSecurityAnalysis(rawData, domain);
                    renderFindings(analysisResults);
                    renderResults(rawData);
                }

                // Restore button state
                analyzeButton.textContent = 'Run Enumeration';
                analyzeButton.disabled = false;
            }, 1000); // 1 second delay
        }

        function performSecurityAnalysis(rawData, baseDomain) {
            let findings = [];
            const today = new Date();
            let wildcardCount = 0;
            let expiredCount = 0;
            let nearExpiryCount = 0;
            let lowSecurityPortCount = 0;
            let caseMismatchCount = 0;

            rawData.forEach(asset => {
                const commonName = asset.common_name;
                const expirationDate = new Date(asset.not_after);
                const daysUntilExpiry = Math.ceil((expirationDate - today) / (1000 * 60 * 60 * 24));

                // Finding 1: Wildcard Certificate Usage
                if (commonName.startsWith('*.')) {
                    wildcardCount++;
                }

                // Finding 2: Expired Certificate
                if (expirationDate < today) {
                    expiredCount++;
                    findings.push({
                        type: 'High Risk',
                        message: `EXPIRED CERTIFICATE found for: ${commonName}. This may cause trust issues and security risks.`,
                        icon: 'ðŸ”´'
                    });
                } 
                
                // Finding 3: Certificate Nearing Expiry (within 30 days)
                else if (daysUntilExpiry <= 30) {
                    nearExpiryCount++;
                    findings.push({
                        type: 'Warning',
                        message: `Certificate for ${commonName} is NEAR EXPIRY (${daysUntilExpiry} days left).`,
                        icon: 'ðŸŸ¡'
                    });
                }

                // Finding 4: Low-Security Protocol/Service Subdomains
                if (commonName.includes('ftp.') || commonName.includes('test') || commonName.includes('dev')) {
                    lowSecurityPortCount++;
                    findings.push({
                        type: 'Informational',
                        message: `Potential legacy/staging asset found: ${commonName}. Confirm it is not publicly accessible.`,
                        icon: 'ðŸ”µ'
                    });
                }
                
                // Finding 5: Case Mismatch (Possible internal confusion or typo)
                if (commonName !== commonName.toLowerCase()) {
                    caseMismatchCount++;
                    findings.push({
                        type: 'Informational',
                        message: `Mixed-case domain found: ${commonName}. Standardize naming for better consistency.`,
                        icon: 'âšª'
                    });
                }
            });

            // Summary Findings (General Health Checks)
            if (wildcardCount > 0) {
                 findings.push({
                    type: 'Informational',
                    message: `Detected ${wildcardCount} wildcard certificates (*.subdomain). While convenient, be aware of the increased risk of compromise if the private key is exposed.`,
                    icon: 'âšª'
                });
            }
            
            // If no major findings, give a green light
            if (findings.length === 0) {
                 findings.push({
                    type: 'Success',
                    message: `No immediate certificate expiry or critical configuration risks found during enumeration.`,
                    icon: 'ðŸŸ¢'
                });
            }


            return findings;
        }

        function renderFindings(findings) {
            findingsList.innerHTML = ''; // Clear previous findings
            findings.forEach(finding => {
                let color = '';
                if (finding.type === 'High Risk') color = 'text-red-700 bg-red-100';
                else if (finding.type === 'Warning') color = 'text-yellow-700 bg-yellow-100';
                else if (finding.type === 'Success') color = 'text-green-700 bg-green-100';
                else color = 'text-blue-700 bg-blue-100';

                const findingElement = document.createElement('div');
                findingElement.className = `p-3 rounded-lg flex items-start ${color}`;
                findingElement.innerHTML = `
                    <span class="mr-3 text-lg">${finding.icon}</span>
                    <p class="text-sm">
                        <span class="font-bold">${finding.type}:</span> ${finding.message}
                    </p>
                `;
                findingsList.appendChild(findingElement);
            });
        }

        function renderResults(data) {
            resultsTableBody.innerHTML = ''; // Clear existing rows
            assetCountSpan.textContent = data.length;

            data.forEach(asset => {
                const row = document.createElement('tr');
                const isExpired = new Date(asset.not_after) < new Date();
                
                let dateClass = 'text-gray-700';
                if (isExpired) {
                    dateClass = 'text-red-600 font-bold';
                } else if (new Date(asset.not_after) - new Date() < 30 * 24 * 60 * 60 * 1000) {
                    dateClass = 'text-yellow-600';
                }

                row.className = 'hover:bg-gray-50 border-b';
                row.innerHTML = `
                    <td class="p-3 text-blue-800 mono font-semibold">${asset.common_name}</td>
                    <td class="p-3 text-gray-600">${asset.issuer_name}</td>
                    <td class="p-3 ${dateClass}">${asset.not_after}</td>
                `;
                resultsTableBody.appendChild(row);
            });
        }

        // Run analysis on default domain on load
        document.addEventListener('DOMContentLoaded', runAnalysis);

    </script>
</body>
</html>
